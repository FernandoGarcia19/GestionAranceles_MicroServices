@page
@model LoginModel
@{
    ViewData["Title"] = "Login";
}

<div class="d-flex justify-content-center align-items-center vh-50 bg-light">
    <div class="card shadow-sm border-0" style="max-width: 420px; width: 100%; position: relative; overflow: hidden;">

        <!-- ðŸ‘¾ MASCOTA -->
        <div id="login-monster" class="monster-wrapper text-center py-3">
            <div class="monster-body mx-auto">
                <div class="monster-head">
                    <!-- Cejas -->
                    <div class="brows">
                        <span class="brow left-brow"></span>
                        <span class="brow right-brow"></span>
                    </div>

                    <!-- Ojos -->
                    <div class="monster-eyes">
                        <div class="eye left">
                            <div class="pupil"></div>
                        </div>
                        <div class="eye right">
                            <div class="pupil"></div>
                        </div>
                    </div>

                    <!-- Nariz -->
                    <div class="nose"></div>

                    <!-- Mejillas -->
                    <div class="cheek left-cheek"></div>
                    <div class="cheek right-cheek"></div>

                    <!-- Bocas -->
                    <div class="mouth mouth-smile"></div>
                    <div class="mouth mouth-o"></div>

                    <!-- Manos -->
                    <div class="monster-hands">
                        <div class="hand left-hand"></div>
                        <div class="hand right-hand"></div>
                    </div>
                </div>
            </div>
            @* <p class="small text-muted mb-0">ðŸ‘€ Hola, ingresa tus datos</p> *@
        </div>
        <!-- /MASCOTA -->

        <div class="card-body p-4 pt-3">
            <div class="text-center mb-3">
                <img src="~/budget.png" alt="Logo" style="height: 60px;" class="mb-2">
                <h3 class="fw-semibold mb-0 text-primary">Iniciar sesiÃ³n</h3>
                <hr class="border-2 border-secondary opacity-25 mt-3 mb-4">
            </div>

            <form method="post">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Usuario</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light"><i class="bi bi-person"></i></span>
                        <input id="usernameInput" asp-for="Input.Username" class="form-control" placeholder="Ingrese su usuario" />
                    </div>
                    <span asp-validation-for="Input.Username" class="text-danger small"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">ContraseÃ±a</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light"><i class="bi bi-lock"></i></span>
                        <input id="passwordInput" asp-for="Input.Password" type="password" class="form-control" placeholder="Ingrese su contraseÃ±a" />
                    </div>
                    <span asp-validation-for="Input.Password" class="text-danger small"></span>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" asp-for="Input.RememberMe" />
                    <label class="form-check-label" asp-for="Input.RememberMe">Recordarme</label>
                </div>

                <button class="btn btn-primary w-100 fw-semibold" type="submit">
                    <i class="bi bi-box-arrow-in-right me-1"></i> Ingresar
                </button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const monster = document.getElementById('login-monster');
            if (!monster) return;

            const username = document.getElementById('usernameInput');
            const password = document.getElementById('passwordInput');
            const pupils = monster.querySelectorAll('.pupil');

            // ðŸ‘‰ estado base: carita normal, manos abajo
            function setIdle() {
                monster.classList.remove('cover-eyes', 'look-down', 'happy');
                pupils.forEach(p => p.style.transform = 'translate(0,0)');
            }

            // forzar estado base al cargar
            setIdle();

            // âš ï¸ algunos navegadores hacen autofill del password
            // y dejan el input con valor pero sin focus.
            // si eso pasa, ahÃ­ SÃ queremos que se tape.
            setTimeout(() => {
                if (password && password.value && password.value.length > 0) {
                    // tiene contraseÃ±a guardada â†’ tÃ¡pate
                    monster.classList.add('cover-eyes');
                } else {
                    setIdle();
                }
            }, 250);

            // ðŸŸ¦ USERNAME: sonrÃ­e y mira
            username.addEventListener('focus', () => {
                setIdle();
                monster.classList.add('look-down');
                monster.classList.add('happy');
            });

            username.addEventListener('input', (e) => {
                const len = (e.target.value || '').length;
                const offsetX = Math.min(len * 10, -5);
                const offsetY = 6;
                pupils.forEach(p => {
                    p.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
                });
            });

            // ðŸŸ¥ PASSWORD: tapar ojos
            password.addEventListener('focus', () => {
                monster.classList.remove('happy');
                monster.classList.remove('look-down');
                monster.classList.add('cover-eyes');
                pupils.forEach(p => p.style.transform = 'translate(0,0)');
            });

            password.addEventListener('input', () => {
                monster.classList.remove('happy');
                monster.classList.add('cover-eyes');
            });

            // ðŸŸ¨ salir de los inputs â†’ volver a normal
            [username, password].forEach(inp => {
                inp.addEventListener('blur', () => {
                    setTimeout(() => {
                        if (document.activeElement !== username &&
                            document.activeElement !== password) {
                            setIdle();
                        }
                    }, 120);
                });
            });
        })();
    </script>
}


<style>
    /* Fondo header */
    .monster-wrapper {
        background: linear-gradient(180deg, #e0f2fe 0%, #ffffff 95%);
    }

    /* Cabeza */
    .monster-body {
        width: 150px;
        height: 150px;
        background: #ffffff;
        border-radius: 50%;
        margin-inline: auto;
        box-shadow: 0 6px 18px rgba(13,110,253,.12);
        border: 3px solid rgba(13,110,253,.06);
        position: relative;
        margin-bottom: 4px;
    }
    .monster-body::before, .monster-body::after {
        content: "";
        position: absolute;
        top: -20px;
        width: 40px;
        height: 40px;
        background: #ffffff;
        border-radius: 50%;
        border: 3px solid rgba(13,110,253,.06);
    }
    .monster-body::before { left: 18px; }
    .monster-body::after  { right: 18px; }

    .monster-head { position: absolute; inset: 0; }

    /* Cejas */
    .brows {
        position: absolute;
        top: 40px;
        left: 0; right: 0;
        display: flex; justify-content: center; gap: 34px;
        z-index: 3;
    }
    .brow {
        width: 28px; height: 6px; background: #0f172a; border-radius: 6px;
        transition: transform .2s ease, opacity .2s ease;
        opacity: .85;
    }
    #login-monster.happy .left-brow  { transform: translateY(-6px) rotate(-10deg); }
    #login-monster.happy .right-brow { transform: translateY(-6px) rotate(10deg);  }
    #login-monster.shy .left-brow    { transform: translateY(-2px) rotate(-18deg); }
    #login-monster.shy .right-brow   { transform: translateY(-2px) rotate(18deg);  }

    /* Ojos */
    .monster-eyes {
        position: absolute; top: 58px; left: 0; right: 0;
        display: flex; justify-content: center; gap: 30px; z-index: 2;
    }
    .monster-eyes .eye {
        width: 32px; height: 32px; background: #fff; border-radius: 50%;
        border: 2px solid rgba(15,23,42,.05);
        position: relative; overflow: hidden;
    }
    .monster-eyes .pupil {
        width: 14px; height: 14px; background: #0f172a; border-radius: 50%;
        position: absolute; top: 9px; left: 9px; transition: transform .15s ease-out;
    }
    #login-monster.look-down .pupil { transform: translate(0, 6px); }

    /* Nariz */
    .nose {
        position: absolute; top: 86px; left: 50%; transform: translateX(-50%);
        width: 16px; height: 10px; background: #e5e7eb; border-radius: 10px;
        border: 2px solid rgba(15,23,42,.05);
        z-index: 2;
    }

    /* Mejillas */
    .cheek {
        position: absolute; top: 92px; width: 20px; height: 14px; border-radius: 50%;
        background: #fecdd3; filter: blur(.2px); opacity: 0; transition: opacity .2s ease, transform .2s ease;
        z-index: 1;
    }
    .left-cheek  { left: 44px; }
    .right-cheek { right: 44px; }
    #login-monster.happy .cheek { opacity: 1; transform: scale(1.05); }
    #login-monster.shy   .cheek { opacity: .9; transform: scale(1.0); }

    /* Bocas */
    .mouth { position: absolute; left: 50%; transform: translateX(-50%); transition: all .2s ease; z-index: 2; }
    .mouth-smile {
        top: 112px; width: 58px; height: 26px;
        border-bottom: 6px solid #0f172a;
        border-radius: 0 0 58px 58px / 0 0 26px 26px;
        opacity: .9;
    }
    .mouth-o {
        top: 108px; width: 22px; height: 22px; border: 5px solid #0f172a; border-radius: 50%;
        background: transparent; opacity: 0; transform: translateX(-50%) scale(.7);
    }
    #login-monster.happy .mouth-smile { transform: translateX(-50%) scale(1.05); opacity: 1; }
    #login-monster.happy .mouth-o     { opacity: 0; transform: translateX(-50%) scale(.6); }
    #login-monster.shy .mouth-smile   { opacity: 0; transform: translateX(-50%) scale(.5); }
    #login-monster.shy .mouth-o       { opacity: 1; transform: translateX(-50%) scale(1); }

    /* Manos */
    .monster-hands {
        position: absolute; top: 150px; left: 0; right: 0; pointer-events: none; z-index: 6;
    }
    .hand {
        width: 62px; height: 60px; background: #ffffff;
        border: 3px solid rgba(13,110,253,.18);
        border-radius: 50%;
        position: absolute; top: 0;
        transition: transform .25s ease;
        box-shadow: 0 3px 10px rgba(15,23,42,.08);
    }
    .left-hand  { left: 16px; transform-origin: top left;  }
    .right-hand { right: 16px; transform-origin: top right; }

    /* Taparse bien los ojos */
    #login-monster.cover-eyes .left-hand  { transform: translate(-8px, -78px) rotate(-16deg); }
    #login-monster.cover-eyes .right-hand { transform: translate( 8px, -78px) rotate( 16deg); }

    /* Parpadeo al taparse */
    #login-monster.cover-eyes .pupil { animation: blink .25s forwards; }
    @@keyframes blink {
        to { height: 2px; transform: translate(0, 12px); }
    }

    /* Responsive */
    @@media (max-width: 480px) {
        .monster-body { transform: scale(.9); }
    }
</style>
